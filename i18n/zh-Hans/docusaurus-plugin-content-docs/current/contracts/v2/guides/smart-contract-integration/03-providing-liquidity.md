---
id: providing-liquidity
title: 提供流动性
---

# 提供流动性

## 引言

从智能合约提供流动性时，最重要的是要记住：在任何不同于当前储备比例的汇率下存入代币_容易遭受套利攻击_。例如，如果一对代币x:y的比例为10:2（即价格为5），而有人天真地以5:2（价格为2.5）添加流动性，合约将简单地接受所有代币（改变价格至3.75并开放市场进行套利），但仅发行池代币，使发送者有权获得按正确比例发送的资产量，在这种情况下为5:1。为了避免向套利者捐赠，至关重要的是要在当前价格下添加流动性。幸运的是，确保满足这一条件非常容易！

## 使用路由器

安全地向池添加流动性的最简单方法是使用[路由器](../../reference/smart-contracts/router-02)，它提供了简便的方法来安全地向池添加流动性。如果流动性要添加到ERC-20/ERC-20对中，请使用[addLiquidity](../../reference/smart-contracts/router-02#addliquidity)。如果涉及WETH，请使用[addLiquidityETH](../../reference/smart-contracts/router-02#addliquidityeth)。

这两种方法都要求调用者对_当前价格的看法_做出承诺，这在`amount*Desired`参数中编码。通常，假设当前公平市场价格接近于一对的当前储备比例是相当安全的（因为存在套利）。因此，如果用户想向池中添加1 ETH，并且池的当前DAI/WETH比例为200/1，合理计算得出必须与ETH一起发送200 DAI，这是对1 WETH等于200 DAI的价格的隐含承诺。但是，重要的是要注意，这必须在提交交易_之前_计算。在交易内部查找储备比例并将其作为价格信念依赖是_不安全的_，因为这个比例可以被廉价操纵以损害你。

然而，仍然有可能提交一个编码了关于价格的信念的交易，但由于在交易确认前真实市场价格发生了较大变化，这一信念最终是错误的。出于这个原因，有必要传递一组额外的参数，这些参数编码了调用者对价格变动的容忍度。这些`amount*Min`参数通常应设置为所计算的期望价格的百分比。因此，在1％的容忍水平下，如果我们的用户发送带有1 ETH和200 DAI的交易，`amountETHMin`应设置为例如.99 ETH，而`amountTokenMin`应设置为198 DAI。这意味着，最坏的情况下，将以198 DAI/1 ETH到202.02 DAI/1 ETH（200 DAI/.99 ETH）之间的比率添加流动性。

一旦完成了价格计算，重要的是要确保你的合约a)至少控制着与`amount*Desired`参数传递的数量一样多的代币/ETH，并且b)已经授予路由器撤回这么多代币的批准。