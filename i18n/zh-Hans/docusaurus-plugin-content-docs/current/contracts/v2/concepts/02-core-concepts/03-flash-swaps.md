---
id: flash-swaps
title: 闪电兑换
---

Uniswap 闪电兑换允许您无需预付成本就从 Uniswap 提取任何 ERC20 代币的全部储备，并执行任意逻辑，前提是到交易结束时，您必须：

- 使用相应对等代币支付提取的 ERC20 代币
- 返还提取的 ERC20 代币并加上小额费用

闪电兑换非常有用，因为它们消除了涉及 Uniswap 的多步骤交易中的前期资本要求和不必要的操作顺序限制。

# 示例

## 无资本套利

闪电兑换的一个特别有趣的用例是无资本套利。众所周知，Uniswap 设计的核心部分之一是创造激励机制，使套利者能够将 Uniswap 的价格交易至“公平”的市场价格。虽然从博弈论的角度来看是合理的，但这种策略仅适用于拥有足够资本来利用套利机会的人。闪电兑换完全消除了这一障碍，有效地实现了套利民主化。

想象一下，购买 1 ETH 在 Uniswap 上的成本为 200 DAI（这是通过调用 `getAmountIn` 并将 1 ETH 指定为确切输出计算得出的），而在 Oasis（或任何其他交易场所）上，1 ETH 可以购买 220 DAI。对于任何拥有 200 DAI 的人来说，这种情况代表了 20 DAI 的无风险利润。不幸的是，您可能没有闲置的 200 DAI。但是，通过闪电兑换，只要您能够支付燃气费，这种无风险利润就可以被任何人获取。

### 从 Uniswap 提取 ETH

第一步是乐观地通过闪电兑换从 Uniswap 提取 1 ETH。这将作为我们执行套利的资本。请注意，在此场景中，我们假设：

- 1 ETH 是预先计算出的利润最大化交易
- 自我们计算以来，Uniswap 和 Oasis 上的价格均未变化

在某些情况下，我们可能希望在执行时刻在链上计算利润最大化的交易，这可以抵御价格波动。这可能会相当复杂，具体取决于正在执行的策略。然而，一个常见的策略是在固定外部价格下尽可能有利可图地交易。（这个价格可能是例如 Oasis 上一个或多个订单的平均执行价格。）如果 Uniswap 市场价格远高于或低于这个外部价格，以下示例包含代码，用于计算在 Uniswap 上进行的最大利润交易量：[`ExampleSwapToPrice.sol`](https://github.com/Uniswap/uniswap-v2-periphery/blob/master/contracts/examples/ExampleSwapToPrice.sol)。

### 在外部场所交易

一旦我们从 Uniswap 获得了临时资本 1 ETH，我们现在可以在 Oasis 上将其交易为 220 DAI。一旦收到 DAI，我们需要向 Uniswap 还款。我们已经提到，覆盖 1 ETH 所需的金额是通过 `getAmountIn` 计算的 200 DAI。因此，在向 Uniswap 对等方发送 200 DAI 后，您将剩下 20 DAI 的利润！

## 即时杠杆

闪电兑换可用于提高使用借贷协议和 Uniswap 加杠杆的效率。

考虑 Maker 最简单的形式：一个系统接受 ETH 作为抵押品，并允许铸造 DAI 抵押它，同时确保 ETH 的价值永远不会低于 DAI 价值的 150%。

假设我们使用该系统存入本金 3 ETH，并铸造最大数量的 DAI。在 1 ETH / 200 DAI 的价格下，我们收到 400 DAI。理论上，我们可以通过出售 DAI 获得更多 ETH，存入这些 ETH，铸造最大数量的 DAI（这次会少一些），并重复此过程，直到达到所需的杠杆水平。

使用 Uniswap 作为此流程中 DAI 到 ETH 部分的流动性来源非常简单。然而，以这种方式循环通过协议并不特别优雅，且可能消耗大量燃气。

幸运的是，闪电兑换使我们能够提前全额提取 ETH。如果我们想以 3 ETH 的本金获得 2 倍杠杆，我们可以简单地请求 3 ETH 的闪电兑换并存入 Maker 中的 6 ETH。这使我们能够铸造 800 DAI。如果我们铸造足够多的 DAI 来覆盖我们的闪电兑换（比如 605），剩余的部分可作为防止价格波动的安全边际。

# 开发者资源

- 要了解如何在您的智能合约中集成闪电兑换，请阅读 [使用闪电兑换](../../guides/smart-contract-integration/using-flash-swaps)。