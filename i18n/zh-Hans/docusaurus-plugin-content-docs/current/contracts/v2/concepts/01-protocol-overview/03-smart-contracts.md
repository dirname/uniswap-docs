---
id: smart-contracts
title: 智能合约
---

Uniswap V2 是一个由二元智能合约系统组成的。[核心](#core)合约提供了所有与 Uniswap 交互的各方的基本安全保证。[外围](#periphery)合约与一个或多个核心合约进行交互，但它们本身并不属于核心部分。

# 核心

[源代码](https://github.com/Uniswap/uniswap-v2-core)

核心包含一个单一的[工厂](#factory)和许多[对](#pairs)，工厂负责创建并对这些对进行索引。这些合约非常精简，甚至可以说是极简主义风格。这样做的简单理由是，表面区域较小的合约更容易理解、更少出现错误，并且在功能上更加优雅。这种设计的最大优势可能在于，系统的许多所需属性可以直接在代码中声明，留给错误的空间很小。然而，缺点之一是核心合约对于用户来说不太友好。实际上，对于大多数使用场景，直接与这些合约交互并不推荐。相反，应使用外围合约。

## 工厂

[参考文档](../../reference/smart-contracts/factory)

工厂持有为对提供动力的通用字节码。其主要工作是为每个唯一的代币对创建一个且仅一个智能合约。它还包含了开启协议费用的逻辑。

## 对

[参考文档](../../reference/smart-contracts/pair)

[参考文档 (ERC-20)](../../reference/smart-contracts/pair-erc-20)

对有两个主要目的：作为自动做市商和跟踪池代币余额。它们还公开了可以用于构建去中心化价格预言机的数据。

# 外围

[源代码](https://github.com/Uniswap/uniswap-v2-periphery)

外围是一系列智能合约的集合，旨在支持针对核心的领域特定交互。由于 Uniswap 的无许可性质，下面描述的合约没有任何特殊权限，实际上只是可能的外围类似合约宇宙的一小部分。然而，它们是安全高效地与 Uniswap V2 交互的有用示例。

## 库

[参考文档](../../reference/smart-contracts/library)

库提供了一系列用于获取数据和定价的便利函数。

## 路由器

[参考文档](../../reference/smart-contracts/router-02)

路由器使用库，完全支持前端提供交易和流动性管理功能的所有基本需求。值得注意的是，它原生支持多对交易（例如 x 到 y 到 z），将 ETH 视为头等公民，并提供元交易以移除流动性。

# 设计决策

以下部分描述了在 Uniswap V2 中做出的一些值得注意的设计决策。除非你有兴趣深入了解 V2 内部的工作原理，或者编写智能合约集成，否则这些内容可以跳过！

## 发送代币

通常，需要代币来执行某些功能的智能合约要求潜在的交互者首先在代币合约上进行批准，然后调用一个函数，该函数反过来在代币合约上调用 transferFrom。这不是 V2 对如何接受代币的方式。相反，对在每次交互的_结束_检查其代币余额。然后，在下一次交互的开始，当前余额与存储的值进行差分，以确定当前交互者发送的代币数量。请参阅<a href='/whitepaper.pdf' target='_blank' rel='noopener noreferrer'>白皮书</a>了解为什么是这种情况的解释，但要点是**在调用任何需要代币的方法之前，必须将代币转移给对**（此规则的一个例外是[闪电交换](../core-concepts/flash-swaps)）。

## WETH

与 Uniswap V1 池不同，V2 对不直接支持 ETH，因此 ETH⇄ERC-20 对必须通过 WETH 来模拟。做出这一选择的动机是为了从核心中删除 ETH 特定的代码，从而产生更精简的代码库。然而，终端用户可以通过简单地在周边封装/解封装 ETH 来完全忽略这个实现细节。

路由器完全支持通过 ETH 与任何 WETH 对进行交互。

## 最小流动性

为了缓解舍入误差并增加流动性提供者的理论最小刻度大小，对会燃烧第一个 [MINIMUM_LIQUIDITY](../../reference/smart-contracts/pair#minimum_liquidity) 池代币。对于绝大多数对而言，这将代表一个微不足道的价值。燃烧在第一次流动性提供时自动发生，此后 [totalSupply](../../reference/smart-contracts/pair-erc-20#totalsupply) 将永远受到限制。