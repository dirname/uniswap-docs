---
id: overview
title: 概览
sidebar_position: 1
---

## 引言

作为 DeFi 项目、代币创建者或任何其他感兴趣的一方，您可能希望在 Uniswap V3 池中_激励范围内的流动性提供_。本指南在高级别上描述了一种特定的激励方案，如在 [uniswap-v3-staker](https://github.com/Uniswap/uniswap-v3-staker) 中实现的那样。

## 场景设定

让我们从定义一些术语开始。我们将激励流动性提供的程序称为 `Incentive`；它们由以下参数表征：

- `rewardToken`：也许是最重要的参数，潜在的激励者必须选择他们想要作为提供流动性奖励分发的 ERC20 代币。
- `pool`：必须提供流动性的 Uniswap V3 池的地址。
- `startTime`：以 UNIX 时间戳表示的奖励开始分配的时间。
- `endTime`：以 UNIX 时间戳表示的奖励开始衰减的时间。
- `refundee`：有权在 `Incentive` 结束后收回任何剩余奖励的地址。

最后，每个 `Incentive` 都有一个与之关联的 `reward`，即在整个计划生命周期内分配的 `rewardToken` 的总量。

## 奖励计算

现在我们对 `Incentive` 的样子有了大致的概念，让我们探讨一下奖励是如何实际分配给参与者的。下一节将涉及参与机制，因此我们现在先抽象掉这一点，只关注高层次的设计。

回想一下，`Incentive` 创建者选择了 `reward` 数量和计划持续时间。这直接对应于选择 _每秒分配的 `rewardToken` 数量_；让我们称这个为奖励率。因此，在 `startTime` 和 `endTime` 之间的每一秒，一个恒定数量的代币按比例分配给该秒内所有范围内的流动性。关键的是，这计算了 _所有_ 流动性，而不仅仅是选择参与该计划的流动性。因此，激励创建者应该选择一个他们认为值得在整个计划期间向（可能）所有范围内 LP 分配的奖励率。

## 抵押

那么，用户如何参与这些计划呢？请注意，这一节需要对 [Uniswap V3 位置 NFT 的工作原理](../../reference/periphery/NonfungiblePositionManager)有基本的理解

为了开始参与 `Incentive`，用户必须采取的第一个行动是将他们的位置 NFT _存入_ 到 [规范的抵押合约地址](https://github.com/Uniswap/uniswap-v3-staker#deployments)，实质上暂时将其 NFT 的托管权交给了这个合约。这是必要的，因为正如我们稍后会看到的，抵押合约需要能够保证参与计划的 NFT 中的流动性不能被移除。

一旦存入，用户就可以将他们的 NFT _抵押_ 到与其 NFT 关联的 Uniswap V3 池的任意数量的活跃 `Incentive` 中（请注意，这可以与初始 _存入_ 同时原子性地发生）。抵押的 NFT 然后立即开始根据上述算法赚取奖励。用户可以在计划进行期间定期认领累积的 `rewardToken`，或者等到计划结束后再认领以最小化开销。

## 计划结束

计划被认为结束必须满足两个条件：

1. `block.timestamp >= endTime`：换句话说，计划的持续时间必须已过期。然而，这并不标志着计划的正式结束，因为一些用户可能直到这个 `endTime` 边界及之后仍然参与，以最大化他们的奖励。这直接导致了第二个条件。
2. 所有 NFT 必须解除抵押：只有当参与其中的每一个 NFT 都解除抵押时，一个计划才能结束。为了确保这总是可能的，在计划的 `endTime` 之后 _任何人_ 都可以解除 _任何_ NFT 的抵押（当然，他们不能认领属于 NFT 所有者的未认领 `rewardToken`）。这确保了即使所有用户自己不解除抵押，其他人也可以手动解除他们的抵押，以便计划可以结束。

大多数或所有计划完全结束非常重要，主要是为了让 `refundee` 能够重新获得任何未分配的奖励。在什么条件下未分配的奖励会保留呢？好吧，回想一下，奖励率对 _所有_ 范围内的流动性都是一样的。然而，只有计划参与者实际上可以认领累积的代币，所以很可能所有计划最终都会有一个无法认领的 `rewardToken` 余额。因此，`refundee` 通常会被激励去使计划达到一个正式的结论。这种略微繁琐的设计是由于难以一致地按 Uniswap V3 流动性比例分配奖励的困难造成的。

最后一点说明：在 `endTime` 后仍留在计划中的抵押者实际上可能会看到他们的奖励略有增加或（更可能）逐渐稀释。这些变化的幅度取决于抵押者占总活跃流动性份额、在 `endTime` 后抵押的时间以及解除抵押的顺序。在最坏的情况下，奖励会按持续时间的比例衰减。例如，在两倍的持续时间下，可能剩下一半的奖励，在三倍的情况下，可能剩下三分之一，等等。虽然有些复杂，但从博弈论的角度来看，这种行为可以被大部分忽略。抵押者应该试图在 `endTime` 之后尽快解除抵押并认领奖励，这可能是任何情况下都会出现的结果，因为 `refundee` 会急于重新获得剩余的奖励，并大规模地解除滞后的抵押者。