---
id: local-environment
title: 设置本地开发环境
sidebar_position: 0.5
---

我们经常被问到的一个常见问题是，在与 Uniswap 构建链上集成时，应该使用哪种开发工具集。这个问题没有绝对正确的答案，但在本指南中，我们将推荐一个常见的选择：`Node.js`、`NPM` 和 `Hardhat`。

完成本指南后，您将设置好一个开发环境，可以用于构建文档指南部分中的其他示例，或启动自己的集成项目！

为了尽快让您开始，我们提供了下面的“快速入门”部分，您可以克隆一些模板代码并开始构建。若要从头开始并学习底层概念，请跳转至“从零开始”部分。

# 快速入门

Uniswap 的 [模板仓库](https://github.com/Uniswap/uniswap-first-contract-example) 提供了一个基本的 Hardhat 环境，所需导入已预先加载。您只需克隆它并安装依赖项：

```bash
git clone https://github.com/Uniswap/uniswap-first-contract-example
cd uniswap-first-contract-example
npm install
```

然后跳转至“带有主网分叉的本地节点”以完成设置并开始开发。

# 从零开始

在以下各节中，我们将从零开始创建与模板相同的环境设置，并学习底层概念。

## 设置依赖项

Node 是最常用的 JavaScript 运行时之一。对于我们的目的，它将提供用于编译和测试合约的脚本。如果尚未安装，请安装 NodeJS 及其包管理器 NPM ([说明](https://docs.npmjs.com/downloading-and-installing-node-js-and-npm))。一旦设置好这些依赖项，我们可以初始化项目：

```bash
$ npm init
```

[Hardhat](https://hardhat.org/) 是一套以太坊开发工具，提供了一系列强大的功能，包括 Solidity 编译、测试和部署，所有这些都在一个方便的包装器中。我们将使用 NPM 将 Hardhat 添加到项目中：

```bash
$ npm add --save-dev hardhat
```

安装 Hardhat 后，我们可以调用它来搭建开发环境。首次运行 Hardhat 时，您将可以选择从模板化的 JavaScript 或 TypeScript 项目或空项目开始。由于 Hardhat 非常依赖文件夹结构，我们建议从其中任何一个模板选项开始。初始化 Hardhat 并按照提示进行选择并回答后续提示：

```bash
$ npx hardhat init
```

完成 Hardhat 初始化后，查看一下所设置的内容。文件夹结构应直观易懂，`./contracts` 是编写 Solidity 合约的地方，`./test` 是编写测试的地方，`./scripts` 是编写执行操作（如部署）的脚本的地方。开箱即用，Hardhat 已配置为使用此文件夹结构，除非您知道自己在做什么，否则不要更改！

接下来，我们将使用 NPM 添加 Uniswap V3 合约，这将使我们能够无缝地在新合约中集成协议：

```bash
$ npm add @uniswap/v3-periphery @uniswap/v3-core
```

Uniswap V3 合约使用的是过去版本的 Solidity 编译器。由于我们正在 V3 上构建集成，我们必须告诉 Hardhat 使用正确的编译器来构建这些文件。前往 `./hardhat.config.js` 文件并将 Solidity 版本更改为“0.7.6”：

```jsx
// ...
module.exports = {
  solidity: "0.7.6",
};
```

就这样！现在您应该有了一个功能齐全的开发环境，可以开始构建链上 Uniswap 集成。让我们运行一个快速测试以确认一切设置正确。

## 编译基本合约

为了确认环境配置正确，我们将尝试编译一个基本的 Swap 合约。创建一个新文件，`./contracts/Swap.sol`，并将以下代码粘贴到其中（有关此合约的详细指南可在此处找到 [这里](./swaps/single-swaps))：

```jsx
// SPDX-License-Identifier: GPL-2.0-or-later
pragma solidity =0.7.6;
pragma abicoder v2;

import '@uniswap/v3-periphery/contracts/interfaces/ISwapRouter.sol';
import '@uniswap/v3-periphery/contracts/libraries/TransferHelper.sol';

contract SimpleSwap {
    ISwapRouter public immutable swapRouter;
    address public constant DAI = 0x6B175474E89094C44Da98b954EedeAC495271d0F;
    address public constant WETH9 = 0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2;
    uint24 public constant feeTier = 3000;

    constructor(ISwapRouter _swapRouter) {
        swapRouter = _swapRouter;
    }

    function swapWETHForDAI(uint256 amountIn) external returns (uint256 amountOut) {

        // 将指定数量的 WETH9 转移到此合约。
        TransferHelper.safeTransferFrom(WETH9, msg.sender, address(this), amountIn);
        // 授权路由器花费 WETH9。
        TransferHelper.safeApprove(WETH9, address(swapRouter), amountIn);
        // 注意：要使用此示例，您应该明确设置滑点限制，此处为简化省略
        uint256 minOut = /* 计算最小输出 */ 0;
        uint160 priceLimit = /* 计算价格限制 */ 0;
        // 创建将用于执行交换的参数
        ISwapRouter.ExactInputSingleParams memory params =
            ISwapRouter.ExactInputSingleParams({
                tokenIn: WETH9,
                tokenOut: DAI,
                fee: feeTier,
                recipient: msg.sender,
                deadline: block.timestamp,
                amountIn: amountIn,
                amountOutMinimum: minOut,
                sqrtPriceLimitX96: priceLimit
            });
        // 调用 `exactInputSingle` 执行交换。
        amountOut = swapRouter.exactInputSingle(params);
    }
}
```

为了编译 `./contracts` 文件夹中的所有合约，我们将使用 Hardhat 编译命令：

```bash
$ npx hardhat compile
```

如果环境正确编译，您会看到如下消息：

```bash
成功编译了 { x } 个 Solidity 文件
```

# 带有主网分叉的本地节点

在构建和测试链上协议的集成时，开发者经常会遇到一个问题：主链上的流动性对于彻底测试代码至关重要，但针对像主网这样的实时网络进行测试可能极其昂贵。

请参阅 [SDK 入门指南](../../../sdk/v3/guides/02-local-development)，了解如何使用分叉的完整示例。

有了运行中的本地节点，您可以在测试中使用 `--network localhost` 标志，将 Hardhat 测试套件指向该本地节点：

```bash
$ npx hardhat test --network localhost
```

# 下一步

设置好环境后，您就可以开始构建了。跳转至指南部分，了解您可以集成的 Uniswap 功能。记得将所有合约（.sol 文件）添加到 `./contracts` 文件夹，并将其后续测试添加到 `./tests` 文件夹。然后，通过运行以下命令来针对您的本地分叉节点测试它们：

```bash
$ npx hardhat test --network localhost
```