---
id: v2
title: API V2 参考
sidebar_position: 1
---

# Swap 小组件 API V2 参考

<div className="widget-api">

## 推荐参数 {#recommended-parameters}

| 参数名称       | 参数类型                              | 默认值                 | 描述                                                                                                                                                                                                                                                                                                               |
| --------------- | -------------------------------------- | ----------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `provider`      | `JsonRpcProvider` 或 `Eip1193Provider` | `undefined`                   | 一个[EIP-1193](https://eips.ethereum.org/EIPS/eip-1193) 提供者。参见 [Web3 提供者](../guides/swap-widget.mdx#web3-provider)。                                                                                                                                                                                                       |
| `jsonRpcUrlMap` | `{ [chainId: number]: string[] }`      | `JSON_RPC_FALLBACK_ENDPOINTS` | 按照 chainId 索引的你的 JSON-RPC 端点 URL 映射，用于在用户连接钱包前提供交易报价。如果未为某个链提供任何端点，小工具将回退到公共的 JSON-RPC 端点，这些端点不稳定且受到限流。参见 [JSON-RPC 端点](../guides/swap-widget.mdx#json-rpc-endpoint)。 |

## 可选参数 {#optional-parameters}

| 参数名称                   | 参数类型                                                      | 默认值           | 描述                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| --------------------------- | -------------------------------------------------------------- | ----------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| `convenienceFee`            | `number`                                                       | `undefined`             | 可选地，你可以在通过你的网页应用执行的兑换上收取便利费。允许的范围是 1 到 100 个基点，以兑换输出代币支付，与 Uniswap v3 边缘合同一致。                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| `convenienceFeeRecipient`   | `{[chainId: number]: string}`                                  | `undefined`             | 在每个网络上接收便利费的地址。如果提供了 `convenienceFee`，则必须提供。                                                                                                                                                                                                                                                                                                                                                                                                                                |
| `defaultChainId`            | `number`                                                       | `1`                     | 你可以指定你想提示用户连接其钱包到的 chainId。[查看所有在小工具上支持的链条列表。](https://github.com/Uniswap/widgets/blob/main/src/constants/chains.ts#L4)                                                                                                                                                                                                                                                                                                                         |
| `defaultInputTokenAddress`  | `{[chainId: number]: string}`                                  | `string` 或 `'NATIVE'`  | 对于每个网络链 ID，在输入字段中默认选择的代币地址（例如：USDC）。如果留空，小工具将使用连接链的原生代币作为默认值。这可以通过特殊的字符串 `'NATIVE'` 明确定义。为了方便起见，你可以传递一个单一的字符串而不是 `chainId` 映射。在这种情况下，小工具会假设该字符串对应于 `chaindId=1` 的 L1 以太坊地址。任何在此参数中提供的地址都必须包含在 `tokenList` 中。 |
| `defaultInputAmount`        | `number`                                                       | `0`                     | 输入字段的默认金额（例如：1 ETH）。此值将尊重 `defaultInputTokenAddress` 的小数位。此参数仅在也设置了 `defaultInputTokenAddress` 时有效。此参数与 `defaultOutputTokenAmount` 相互排斥，因此你只能设置 `defaultInputTokenAmount` 和 `defaultOutputTokenAmount` 中的一个。                                                                                                                                                                          |
| `defaultOutputTokenAddress` | `{[chainId: number]: string}`                                  | `string` 或 `undefined` | 对于每个网络链 ID，在输入字段中默认选择的代币地址（例如：USDC）。留空则无。任何在此参数中提供的地址都必须包含在 `tokenList` 中。                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| `defaultOutputAmount`       | `number`                                                       | `0`                     | 输入字段的默认金额（例如：100 USDC）。此值将尊重 `defaultOutputTokenAddress` 的小数位。此参数与 `defaultInputTokenAmount` 相互排斥，因此你只能设置 `defaultInputTokenAmount` 和 `defaultOutputTokenAmount` 中的一个。                                                                                                                                                                                                                                               |
| `hideConnectionUI`          | `boolean`                                                      | `false`                 | 隐藏小工具内置的钱包连接 UI，包括已连接账户的芯片和“连接钱包以兑换”按钮。                                                                                                                                                                                                                                                                                                                                                                                                             |
| `locale`                    | `SupportedLocale`                                              | `en-US`                 | 指定小工具界面使用的明确语言环境。这可以设置为库在 [`SUPPORTED_LOCALES`](https://github.com/Uniswap/widgets/blob/main/src/constants/locales.ts) 中导出的值之一。                                                                                                                                                                                                                                                                                                          |
| `onConnectWalletClick`      | `() => void` 或 `() => Promise<boolean>`                       | `undefined`             | 如果传递，则允许你在用户点击“连接你的钱包以兑换”按钮时添加自定义行为。为了管理显示小工具内置的钱包连接模态，返回一个用 `resolve(true/false)` 解析的承诺。                                                                                                                                                                                                                                                                                             |
| `onSwitchChain`      | `(addChainParameter: AddEthereumChainParameter) => void` 或 `Promise<void>`                       | `undefined`             | 当用户尝试切换链条时调用的集成钩子。如果钩子返回一个 Promise，假定集成商正在尝试切换链条，并且不会进一步尝试。如果该 Promise 被拒绝，错误将被忽略，以免使小工具崩溃。                                                                                                                                                                                                                                                                                                                                                                                                                             |
| `onError`                   | `ErrorHandler`                                                 | `undefined`             | 一个错误处理器，接收发生在小工具中的任何 Javascript 错误。这可用于收集错误指标。                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| `onReviewSwapClick`         | `() => void` 或 `() => Promise<boolean>`                       | `undefined`             | 如果传递，允许你在用户点击“审核兑换”按钮时添加自定义行为。为了管理进展到审核屏幕（即添加预兑换警告），返回一个用 `resolve(true/false)` 解析的承诺。                                                                                                                                                                                                                                                                                                                                                                                                                          |
| `onTokenSelectorClick`      | `(f: Field) => void \| (f: Field) => Promise<boolean \| void>` | `undefined`             | 当用户点击代币选择器下拉菜单时，带有选定的 `Field`（`'INPUT'\|'OUTPUT'`）触发的点击处理器。为了管理进展到原生代币选择器视图（即利用你自己的外部代币选择器 UI），返回一个用 resolve(true/false) 解析的承诺。                                                                                                                                                                                                                                                                                                          |
| `onTxFail`                  | `(error: Error, data: any) => void`                            | `undefined`             | 一个错误处理器，接收链上交易失败的错误数据。不包括当用户取消交易或交易无法提交的情况。                                                                                                                                                                                                                                                                                                                                                                                                                       |
| `onTxSubmit`                | `(txHash: string, data: any) => void`                          | `undefined`             | 当用户提交交易时，接收交易哈希和相关数据的处理器。                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| `onTxSuccess`               | `(txHash: string, data: any) => void`                          | `undefined`             | 当交易在链上成功时，接收交易哈希和相关数据的处理器。                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| `routerUrl`                 | `string`                                                       | `undefined`             | 可选地提供你自己托管的 Uniswap 路由器 API 的基础 URL。如果没有提供，最优交易路线将通过在浏览器本地运行 @uniswap/smart-order-router 包来计算；这可能需要几秒钟加载，且较慢。你也可能能够使用路由器 API 找到更优的路线！参阅更多关于 [部署路由器 API](https://github.com/Uniswap/routing-api#deploying-the-api)。                                                                                |
| `theme`                     | `Theme`                                                        | `lightTheme`            | 指定自定义主题（颜色、字体和边框半径）。参见 [自定义主题](../guides/swap-widget.mdx#customizing-theme)。                                                                                                                                                                                                                                                                                                                                                                                                            |
| `tokenList`                 | `string`                                                       | `TokenInfo[]`           | 指定默认出现在代币选择器列表中的代币集合。接受 Token Lists 标准定义的令牌列表的 URI，或内联的代币数组。如果没有提供，将使用 Uniswap Labs 默认的代币列表。参见 [自定义默认代币列表](../guides/swap-widget.mdx#customizing-default-token-list)。                                                                                                                                                                            |
| `width`                     | `number` 或 `string`                                           | `360`                   | 指定小工具的宽度。如果指定为数字，这是以像素为单位；否则，它被解释为 CSS `<length>` 数据类型。推荐宽度为 360px。最小宽度为 300px。参见 [自定义宽度](../guides/swap-widget.mdx#customizing-width)。                                                                                                                                                                                                                                                                                                                                       |
| `brandedFooter`                     | `boolean`                                           | `true`                   | 启用小工具底部的“由 Uniswap 提供动力”的页脚。                                                                                                                                                                                                                                                                       |
| `dialog`                     | `HTMLDivElement`                                           | `undefined`                   | 指定门户小工具对话框（例如：摘要，交易对话框）的元素。                                                                                                                                                                                                                                                                      |
| `dialogOptions`                     | `DialogOptions`                                           | `undefined`                   | 指定更多自定义对话行为，如过渡动画。                                                                                                                                                                                                                                                                      |


## 订阅事件

在 Swap 小组件的生命周期中，你需要的大多数事件都可以从 web3 提供者中获取。例如，下面的代码片段展示了如何监听钱包账户变化或新钱包连接的事件。你可以在 [MetaMask](https://docs.metamask.io/guide/ethereum-provider.html) 文档中看到更多的事件示例。

```js
// 订阅消息
interface ProviderMessage {
  type: string;
  data: unknown;
}

ethereum.on(
  'message',
  handler: (message: ProviderMessage) => void
);
```

</div>

:::note 问题？
加入 [Discord 频道](https://discord.com/channels/597638925346930701/941447445844463676)，提问并从 Uniswap 社区获得支持。
:::