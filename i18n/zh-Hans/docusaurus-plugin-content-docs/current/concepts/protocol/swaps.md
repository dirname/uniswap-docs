---
id: swaps
title: 交换
sidebar_position: 5
---

## 引言

交换是与Uniswap协议互动最常见的方式。对于终端用户而言，进行交换非常直接：用户选择他们拥有的ERC-20代币以及他们希望交易得到的代币。执行交换会以当前拥有代币的相应[^1]数量减去交换费用（该费用奖励给流动性提供者[^2]）来卖出这些代币，换取所需的代币。使用Uniswap协议进行交换是一个无需许可的过程。

> 注意：通过网络界面（网站）使用Uniswap协议进行交换可能会引入额外的权限结构，并且与直接使用Uniswap协议相比，可能导致不同的执行行为。要了解协议和网络界面之间的区别，请参阅什么是Uniswap。

使用Uniswap协议进行的交换与传统的订单簿交易不同，它们不是按照先进先出的原则针对离散的订单执行的——相反，交换是针对一个被动的流动性池执行的，流动性提供者根据其投入资本的比例赚取费用。

## 价格影响

在传统的订单簿市场中，大量的市价买入订单可能会耗尽前一个限价卖出的可用流动性，并继续以更高的价格执行后续的限价卖出订单。结果是，订单的最终执行价格位于两个限价卖出价格之间，这两个价格是订单成交时的价格。

价格影响以类似的方式影响交换的执行价格，但这是由不同的动态造成的。当使用自动做市商时，在执行交换的过程中，一种资产相对于另一种资产的相对价值会持续变化，导致最终的执行价格位于相对价格开始和结束之间的某个位置。

这种动态影响到每一个使用Uniswap协议的交换，因为它是AMM设计不可分割的一部分。

由于在不同的价格点上可获得的流动性量可能各不相同，因此对于给定的交换规模，价格影响将相对于任何给定点价格空间内可获得的流动性量而变化。在特定价格下可用的流动性越多，对于给定的交换规模，价格影响就越小。可用的流动性越少，价格影响就越高。

Uniswap界面实时预测了近似[^3]的价格影响，如果在交换过程中发生异常高的价格影响，会出现警告。任何执行交换的人都有能力在需要时评估价格影响的情况。

## 滑点

在使用Uniswap协议进行交换时，另一个需要考虑的相关细节是滑点。我们使用滑点这个词来描述提交的交易在等待执行时可能发生的价格变化。

当交易提交给以太坊时，它们的执行顺序是由作为每笔交易执行费用提供的“Gas”数量确定的。提供的费用越高，交易执行得越快。具有较低Gas费用的交易将无限期地保持待处理状态。在这段时间内，交易最终将被执行的价格环境会发生变化，因为其他交换正在发生。

滑点容忍度建立了超出价格影响用户可接受的价格变化范围。只要执行价格在滑点范围内，例如%1，交易就会执行。如果执行价格最终超出了可接受的滑点范围，交易将失败，交换不会发生。

在传统市场中，一个可比较的情况是在延迟后执行的市价买入订单。当提交市价买入订单时，可以知道预期价格，但在提交和执行之间的时间内，很多事情都会改变。

## 安全检查

在交易等待期间，价格影响和滑点都可能发生改变，这就是为什么我们在Uniswap协议中构建了许多安全检查来保护终端用户免受其交换执行环境剧烈变化的影响。一些最常见的安全检查：

- **过期**：如果交换等待时间超过预设的截止时间，则会发生交易错误。截止时间是之后交换将被取消的时间点，以防止异常长的待处理期和通常伴随时间流逝的价格变化。

- **INSUFFICIENT_OUTPUT_AMOUNT**：当用户提交交换时，Uniswap界面将发送用户应该期望收到多少购买代币的估计值。如果交换的预期输出量没有在一定误差范围内（滑点容忍度）匹配估计值，交换将被取消。这试图保护用户免受其交易等待期间任何急剧不利的价格变化。

[^1]: 在这种情况下，相应地考虑了许多因素，包括一种代币相对于另一种代币的相对价格、滑点、价格影响以及与Ethereum开放和对抗性质相关的其他因素。
[^2]: 有关流动性提供的信息，请参阅流动性用户指南
[^3]: Uniswap界面会通知用户关于他们交换的情况，但这并不保证。