"use strict";(self.webpackChunk_uniswap_docs=self.webpackChunk_uniswap_docs||[]).push([[8073],{73133:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>l,default:()=>d,frontMatter:()=>r,metadata:()=>i,toc:()=>p});var n=a(83117),o=(a(67294),a(3905));const r={id:"examples",title:"Query Examples",sidebar_position:3},l="Subgraph Query Examples",i={unversionedId:"api/subgraph/guides/examples",id:"api/subgraph/guides/examples",title:"Query Examples",description:"This doc will teach you how to query Uniswap V3 analytics by writing GraphQL queries on the subgraph. You can fetch data points like :",source:"@site/docs/api/subgraph/guides/subgraph-example.md",sourceDirName:"api/subgraph/guides",slug:"/api/subgraph/guides/examples",permalink:"/uniswap-docs/en/api/subgraph/guides/examples",editUrl:"https://github.com/uniswap/uniswap-docs/tree/main/docs/api/subgraph/guides/subgraph-example.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{id:"examples",title:"Query Examples",sidebar_position:3},sidebar:"apiSidebar",previous:{title:"Overview",permalink:"/uniswap-docs/en/api/subgraph/overview"}},s={},p=[{value:"Global Data",id:"global-data",level:2},{value:"Current Global Data",id:"current-global-data",level:3},{value:"Historical Global Data",id:"historical-global-data",level:3},{value:"Pool Data",id:"pool-data",level:2},{value:"General Pool Query",id:"general-pool-query",level:3},{value:"All Possible Pools",id:"all-possible-pools",level:3},{value:"Skipping First 1000 Pools",id:"skipping-first-1000-pools",level:3},{value:"Creating a Skip Variable",id:"creating-a-skip-variable",level:3},{value:"Most Liquid Pools",id:"most-liquid-pools",level:3},{value:"Pool Daily Aggregated",id:"pool-daily-aggregated",level:3},{value:"Swap Data",id:"swap-data",level:2},{value:"General Swap Data",id:"general-swap-data",level:3},{value:"Recent Swaps Within a Pool",id:"recent-swaps-within-a-pool",level:3},{value:"Token Data",id:"token-data",level:2},{value:"General Token Data",id:"general-token-data",level:3},{value:"Token Daily Aggregated",id:"token-daily-aggregated",level:3},{value:"All Tokens",id:"all-tokens",level:3},{value:"Position Data",id:"position-data",level:2},{value:"General Position Data",id:"general-position-data",level:3},{value:"Contribute",id:"contribute",level:2}],u={toc:p};function d(e){let{components:t,...a}=e;return(0,o.kt)("wrapper",(0,n.Z)({},u,a,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"subgraph-query-examples"},"Subgraph Query Examples"),(0,o.kt)("p",null,"This doc will teach you how to query Uniswap V3 analytics by writing GraphQL queries on the subgraph. You can fetch data points like :"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#general-position-data"},"collected fees for a position")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#pool-data"},"current liquidity")," of a pool"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#historical-global-data"},"volume on a certain day"))),(0,o.kt)("p",null,"and much more. Below are some example queries. To run a query copy and paste it into the ",(0,o.kt)("a",{parentName:"p",href:"https://thegraph.com/hosted-service/subgraph/uniswap/uniswap-v3"},"v3 explorer")," to get fresh data."),(0,o.kt)("h2",{id:"global-data"},"Global Data"),(0,o.kt)("p",null,"Global data refers to data points about the Uniswap v3 protocol as a whole. Some examples of global data points are total value locked in the protocol, total pools deployed, or total transaction counts. Thus, to query global data you must pass in the Uniswap V3 Factory address ",(0,o.kt)("inlineCode",{parentName:"p"},"0x1F98431c8aD98523631AE4a59f267346ea31F984")," and select the desired fields. Reference the full ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/Uniswap/v3-subgraph/blob/main/schema.graphql#L1"},"factory schema")," to see all possible fields."),(0,o.kt)("h3",{id:"current-global-data"},"Current Global Data"),(0,o.kt)("p",null,"An example querying total pool count, transaction count, and total volume in USD and ETH:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'{\n  factory(id: "0x1F98431c8aD98523631AE4a59f267346ea31F984" ) {\n    poolCount\n    txCount\n    totalVolumeUSD\n    totalVolumeETH\n  }\n}\n')),(0,o.kt)("h3",{id:"historical-global-data"},"Historical Global Data"),(0,o.kt)("p",null,"You can also query historical data by specifying a block number."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'{\n  factory(id: "0x1F98431c8aD98523631AE4a59f267346ea31F984", block: {number: 13380584}){\n    poolCount\n    txCount\n    totalVolumeUSD\n    totalVolumeETH\n  }\n}\n')),(0,o.kt)("h2",{id:"pool-data"},"Pool Data"),(0,o.kt)("p",null,"To get data about a certain pool, pass in the pool address. Reference the full ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/Uniswap/v3-subgraph/blob/main/schema.graphql#L75"},"pool schema")," and adjust the query fields to retrieve the data points you want."),(0,o.kt)("h3",{id:"general-pool-query"},"General Pool Query"),(0,o.kt)("p",null,"The query below returns the feeTier, spot price, and liquidity for the ETH-USDC pool."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'{\n  pool(id: "0x8ad599c3a0ff1de082011efddc58f1908eb6e6d8") {\n    tick\n    token0 {\n      symbol\n      id\n      decimals\n    }\n    token1 {\n      symbol\n      id\n      decimals\n    }\n    feeTier\n    sqrtPrice\n    liquidity\n  }\n}\n')),(0,o.kt)("h3",{id:"all-possible-pools"},"All Possible Pools"),(0,o.kt)("p",null,"The maxiumum items you can query at once is 1000. Thus to get all possible pools, you can interate using the skip variable. To get pools beyond the first 1000 you can also set the skip as shown below."),(0,o.kt)("h3",{id:"skipping-first-1000-pools"},"Skipping First 1000 Pools"),(0,o.kt)("p",null,"This query sets the skip value and returns the first 10 responses after the first 1000."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"{\n  pools(first:10, skip:1000){\n    id\n    token0 {\n      id\n      symbol\n    }\n    token1 {\n      id\n      symbol\n    }\n  }\n}\n")),(0,o.kt)("h3",{id:"creating-a-skip-variable"},"Creating a Skip Variable"),(0,o.kt)("p",null,"This next query sets a skip variable. In your language and environment of choice you can then iterate through a loop, query to get 1000 pools each time, and continually adjust skip by 1000 until all pool responses are returned."),(0,o.kt)("p",null,"Check out ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/Uniswap/v3-info/blob/770a05dc1a191cf229432ebc43c1f2ceb3666e3b/src/data/pools/chartData.ts#L14"},"this example")," from our interface for poolDayData that does something similar."),(0,o.kt)("p",null,"Note: This query will not work in the graph explorer and more resembles the structure of a query you'd pass to some graphql middleware like Apollo."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"query pools( $skip: Int!) {\n    pools(\n      first: 1000\n      skip: $skip\n      orderDirection: asc\n    ) {\n      id\n      sqrtPrice\n      token0 {\n        id\n      }\n      token1 {\n        id\n      }\n    }\n  }\n\n")),(0,o.kt)("h3",{id:"most-liquid-pools"},"Most Liquid Pools"),(0,o.kt)("p",null,"Retrieve the top 1000 most liquid pools. You can use this similar set up to orderBy other variables like number of swaps or volume."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"{\n pools(first: 1000, orderBy: liquidity, orderDirection: desc) {\n   id\n }\n}\n")),(0,o.kt)("h3",{id:"pool-daily-aggregated"},"Pool Daily Aggregated"),(0,o.kt)("p",null,"This query returns daily aggregated data for the first 10 days since the given timestamp for the UNI-ETH pool."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'{\n  poolDayDatas(first: 10, orderBy: date, where: {\n    pool: "0x1d42064fc4beb5f8aaf85f4617ae8b3b5b8bd801",\n    date_gt: 1633642435\n  } ) {\n    date\n    liquidity\n    sqrtPrice\n    token0Price\n    token1Price\n    volumeToken0\n    volumeToken1\n  }\n}\n')),(0,o.kt)("h2",{id:"swap-data"},"Swap Data"),(0,o.kt)("h3",{id:"general-swap-data"},"General Swap Data"),(0,o.kt)("p",null,'To query data about a particular swap, input the transaction hash + "#" + the index in the swaps the transaction array.R\nThis is the reference for the full ',(0,o.kt)("a",{parentName:"p",href:"https://github.com/Uniswap/v3-subgraph/blob/main/schema.graphql#L353"},"swap schema"),"."),(0,o.kt)("p",null,"This query fetches data about the sender, receiver, amounts, transaction data, and timestamp for a particular swap."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'{\n   swap(id: "0x000007e1111cbd97f74cfc6eea2879a5b02020f26960ac06f4af0f9395372b64#66785") {\n    sender\n    recipient\n    amount0\n    amount1\n    transaction {\n      id\n      blockNumber\n      gasUsed\n      gasPrice\n    }\n    timestamp\n    token0 {\n      id\n      symbol\n    }\n    token1 {\n      id\n      symbol\n    }\n   }\n }\n')),(0,o.kt)("h3",{id:"recent-swaps-within-a-pool"},"Recent Swaps Within a Pool"),(0,o.kt)("p",null,"You can set the ",(0,o.kt)("inlineCode",{parentName:"p"},"where")," field to filter swap data by pool address. This example fetches data about multiple swaps for the USDC-USDT pool, ordered by timestamp."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'{\nswaps(orderBy: timestamp, orderDirection: desc, where:\n { pool: "0x7858e59e0c01ea06df3af3d20ac7b0003275d4bf" }\n) {\n  pool {\n    token0 {\n      id\n      symbol\n    }\n    token1 {\n      id\n      symbol\n    }\n  }\n  sender\n  recipient\n  amount0\n  amount1\n }\n}\n')),(0,o.kt)("h2",{id:"token-data"},"Token Data"),(0,o.kt)("p",null,"Input the the token contract address to fetch token data. Any token that exists in at least one Uniswap V3 pool can be queried. The output will aggregate data across all v3 pools that include the token."),(0,o.kt)("h3",{id:"general-token-data"},"General Token Data"),(0,o.kt)("p",null,"This queries the decimals, symbol, name, pool count, and volume in USD for the UNI token. Reference the full ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/Uniswap/v3-subgraph/blob/main/schema.graphql#L38"},"token schema")," for all possible fields you can query."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'{\n  token(id:"0x1f9840a85d5af5bf1d1762f925bdaddc4201f984") {\n    symbol\n    name\n    decimals\n    volumeUSD\n    poolCount\n  }\n}\n')),(0,o.kt)("h3",{id:"token-daily-aggregated"},"Token Daily Aggregated"),(0,o.kt)("p",null,"You can fetch aggregate data about a specific token over a 24-hour period. This query gets 10-days of the 24-hour volume data for the UNI token ordered from oldest to newest."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'{\n  tokenDayDatas(first: 10, where: {token: "0x1f9840a85d5af5bf1d1762f925bdaddc4201f984"}, orderBy: date, orderDirection: asc) {\n    date\n    token {\n      id\n      symbol\n    }\n    volumeUSD\n  }\n}\n')),(0,o.kt)("h3",{id:"all-tokens"},"All Tokens"),(0,o.kt)("p",null,"Similar to retrieving all pools, you can fetch all tokens by using skip.\nNote: This query will not work in the graph sandbox and more resembles the structure of a query you'd pass to some graphql middleware like Apollo."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"query tokens($skip: Int!) {\n  tokens(first: 1000, skip: $skip) {\n    id\n    symbol\n    name\n  }\n}\n")),(0,o.kt)("h2",{id:"position-data"},"Position Data"),(0,o.kt)("h3",{id:"general-position-data"},"General Position Data"),(0,o.kt)("p",null,"To get data about a specific position, input the NFT tokenId. This queries the collected fees for token0 and token1 and current liquidity for the position with tokedId 3. Reference the full ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/Uniswap/v3-subgraph/blob/main/schema.graphql#L192"},"position schema")," to see all fields."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"{\n  position(id:3) {\n    id\n    collectedFeesToken0\n    collectedFeesToken1\n    liquidity\n    token0 {\n      id\n      symbol\n    }\n    token1\n    {\n      id\n      symbol\n    }\n  }\n}\n")),(0,o.kt)("h2",{id:"contribute"},"Contribute"),(0,o.kt)("p",null,"There are many more queries you can do with the Uniswap v3 subgraph including data related to ticks, mints, positions, and burns. Once again you can reference the full schema ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/Uniswap/v3-subgraph/blob/main/schema.graphql"},"here"),". If you'd like to suggest more example queries to showcase, feel free to drop some suggestions in ",(0,o.kt)("a",{parentName:"p",href:"https://discord.com/invite/uniswap"},"discord")," under #dev-chat or ",(0,o.kt)("a",{parentName:"p",href:"../../../../CONTRIBUTING.md"},"contribute")," your own queries by submitting a pull request to the docs repo."))}d.isMDXComponent=!0},3905:(e,t,a)=>{a.d(t,{Zo:()=>u,kt:()=>h});var n=a(67294);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function i(e,t){if(null==e)return{};var a,n,o=function(e,t){if(null==e)return{};var a,n,o={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(o[a]=e[a]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}var s=n.createContext({}),p=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},u=function(e){var t=p(e.components);return n.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},c=n.forwardRef((function(e,t){var a=e.components,o=e.mdxType,r=e.originalType,s=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),c=p(a),h=o,m=c["".concat(s,".").concat(h)]||c[h]||d[h]||r;return a?n.createElement(m,l(l({ref:t},u),{},{components:a})):n.createElement(m,l({ref:t},u))}));function h(e,t){var a=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=a.length,l=new Array(r);l[0]=c;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i.mdxType="string"==typeof e?e:o,l[1]=i;for(var p=2;p<r;p++)l[p]=a[p];return n.createElement.apply(null,l)}return n.createElement.apply(null,a)}c.displayName="MDXCreateElement"}}]);